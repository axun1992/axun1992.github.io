---
layout: post
title:  "UE示例学习-动画IKRig"
tags: ue
---
动画IK Rig映射提供了一些示例以演示一个IK Rig如何控制骨架网格的姿态。通过与解算器交互（例如：Full Body IK）,数据可以被动画蓝图驱动，以编辑骨架网格的姿态。  
同时也展示了一系列的IK Rig资产技术，例如与动画一起附加的使用IK。  
<!--more-->

### IK目标
单个IK目标驱动全身IK。
#### 实操 

1. 在Actor蓝图的Tick中修改变量`Position`的值。
2. 在动画蓝图的事件图表中`Get Owning Actor`并获取`Position`的值，同步到动画蓝图这边的变量上。
3. 在动画蓝图的动画图表中使用`IK Rig`节点，给该节点的`Rig Definition Asset`字段设置好IK Rig资产后，节点将显示对应的IK目标的Position引脚。
4. 把`Position`传递给IK目标的Position引脚。

在案例中使用了Full Body IK，是个功能齐全的多目标IK解算器，支持骨骼限制、刚度和首选角度的调整。如果你想为多个目标创建大规模IK系统，每个目标都对全身施加自然影响，那么这个解算器就很有用。

那么，如何创建IK Rig资产呢？  
在内容浏览器中，`Animation`->`IK Rig`，选择关联的骨架网格体进行创建。  
IK目标  
IK目标（IK Goal）是IK链的操控点和执行器点，在IK Rig编辑器中创建。IK目标与解算器一起使用，以修改传入姿势来到达目标位置。  
要创建IK目标，请首先在你想创建的IK链中选择结束骨骼。通常，如果你是沿手臂或腿部创建IK，那么就选择手或脚的骨骼。然后右键创建新的IK目标。  

解算器  
IK Rig支持多种IK解算器，可以作用于各种骨骼层级。它们用于创建逆向运动学解决方案，从而在链中旋转和定位骨骼。可同时使用多个解算器进一步个性化IK效果。  
创建解算器的主要方式是点击解算器堆栈（Solver Stack）面板中的添加新解算器（Add New Solver），然后选择一个解算器。  
所有IK解算器都需指定一个根骨骼或Ik目标，或同时指定两者。方法时同时选中解算器和骨骼，然后在右键菜单里建立关联。  

### 多解算器
使用多个不同类型的解算器。
#### 实操 
多个解算器可以在解算器堆栈中依次应用。  
另外，每个IK目标可以设置是否暴露引脚到`IK Rig`节点上，供动画图表修改。  

### 长骨骼链
全身IK~每条腿20根骨骼。  
#### 实操 
使用了Full Body IK，并设置好根和IK目标。这种解算器可以高效的处理长骨骼链。  

### 链拉力
不同链拉力下的IK效果。  
#### 实操 
在IK目标下的全身IK解算器设置中，`Pull Chain Alpha`控制链整体靠向IK目标的程度，0最小，1最大。  

### 骨骼限制
设置每个骨骼的旋转限制。  
#### 实操 
在使用全身IK解算器时，每个受影响骨骼可以右键创建解算器设置，在设置中可以对X、Y、Z三轴分别设置角度的旋转限制范围。  

### 首选角度
设置每个骨骼的首选角度。  
#### 实操 
在使用全身IK解算器时，每个受影响骨骼可以右键创建解算器设置，在设置中可以设置`Preferred Angles`，在IK链被挤压时，骨骼将优先旋转到它的首选角度上。  

### 叠加IK
在动画上叠加IK。  
#### 实操 
在动画图表的`IK Rig`节点属性的`Goals`分类下，可以设置每个IK目标为`Manual Input`并设置`Position Space`为`Additive`。  

### 叠加注视
在动画上叠加IK注视效果。  
#### 实操 
依然使用全身IK解算器以及头部的叠加IK目标。在Actor蓝图中，计算注视点相对于头部IK目标的偏移位置，然后传递给IK目标。  

### 到达目标
角色的手指到某特定位置上的目标。  
#### 实操 
依然使用全身IK解算器以及手部的世界坐标IK目标。把目标的世界坐标传递给IK目标。  
此外，通过一个曲线（在点击动画中定义）来控制IK目标的`Position Alpha`，以达到在点击动作做出来时，刚好手部IK达到目标处；在其它时刻，则源动画位置占比更多。  

### 拉伸
角色的手指到某特定位置上的目标。  
#### 实操 
在全身IK解算器的属性上启用`Allow Stretch`。另外，在pelivs上忽略IK效果更好，示例没有这样做。  