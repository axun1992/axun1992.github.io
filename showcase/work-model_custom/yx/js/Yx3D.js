var Yx3D={};Yx3D.Init=function(){Yx3D.Container=document.getElementById("Yx3D");Yx3D.Scene=new THREE.Scene;Yx3D.Camera=new THREE.PerspectiveCamera(45,Yx3D.Container.clientWidth/Yx3D.Container.clientHeight,.25,20);Yx3D.Camera.position.set(0,.6,5);Yx3D.Scene.add(Yx3D.Camera);Yx3D.Renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});Yx3D.Renderer.setClearAlpha(0);Yx3D.Renderer.setSize(Yx3D.Container.clientWidth,Yx3D.Container.clientHeight);Yx3D.Renderer.outputEncoding=THREE.LinearEncoding;Yx3D.Renderer.shadowMap.enabled=true;Yx3D.Renderer.shadowMap.type=THREE.PCFSoftShadowMap;Yx3D.Container.appendChild(Yx3D.Renderer.domElement);Yx3D.CamerCtrl=new THREE.OrbitControls(Yx3D.Camera,Yx3D.Renderer.domElement);Yx3D.CamerCtrl.minDistance=2;Yx3D.CamerCtrl.maxDistance=15;Yx3D.CamerCtrl.target.set(0,0,0);window.addEventListener("resize",Yx3D.OnWindowResize);var e=new THREE.AmbientLight(16777215,.2);Yx3D.Scene.add(e);var n=new THREE.DirectionalLight(16777215,1);n.position.set(0,0,1);n.rotation.set(0,0,90);Yx3D.Camera.add(n);var r=function(e){event.preventDefault();Yx3D._downX=e.offsetX;Yx3D._downY=e.offsetY};Yx3D.Renderer.domElement.addEventListener("mousedown",r,false);Yx3D.Renderer.domElement.addEventListener("click",Yx3D.Pick,false);Yx3D.Render()};Yx3D.OnWindowResize=function(){Yx3D.Camera.aspect=Yx3D.Container.clientWidth/Yx3D.Container.clientHeight;Yx3D.Camera.updateProjectionMatrix();Yx3D.Renderer.setSize(Yx3D.Container.clientWidth,Yx3D.Container.clientHeight)};Yx3D.Render=function(){requestAnimationFrame(Yx3D.Render);Yx3D.CamerCtrl.update();Yx3D.Renderer.render(Yx3D.Scene,Yx3D.Camera)};Yx3D.LoadModel=function(d,l){if(Yx3D.CurrModel!=undefined){Yx3D.Scene.remove(Yx3D.CurrModel.scene);Yx3D.CurrModel=undefined}var e=new THREE.GLTFLoader;e.load(d,function(e){e.scene.children[0].scale.set(.1,.1,.1);Yx3D.CurrModel=e;var n=d+".tex/";var r=new THREE.TextureLoader;var a=r.load(n+"glove_color.jpg");a.encoding=THREE.LinearEncoding;a.flipY=false;var t=r.load(n+"glove_metallic.jpg");t.encoding=THREE.LinearEncoding;t.flipY=false;var i=r.load(n+"glove_normal.jpg");i.encoding=THREE.LinearEncoding;i.flipY=false;var o=r.load(n+"glove_roughness.jpg");o.encoding=THREE.LinearEncoding;o.flipY=false;Yx3D.CurrModel.scene.children[0].traverse(function(e){if(e.material&&(e.material.isMeshStandardMaterial||e.material.isShaderMaterial&&e.material.envMap!==undefined)){var n=new THREE.Color;n.setStyle("#ffffff");e.material.color=n;e.material.map=a;e.material.metalnessMap=t;e.material.metalness=1;e.material.normalMap=i;e.material.roughnessMap=o;e.material.emissive=new THREE.Color(0,0,0);e.material.needsUpdate=true}});Yx3D.Scene.add(e.scene);l(e)})};Yx3D.GetEnvMap=function(){if(Yx3D.envMap){return Yx3D.envMap}var e="./yx/res/cube/Park2/";var n=".jpg";var r=[e+"posx"+n,e+"negx"+n,e+"posy"+n,e+"negy"+n,e+"posz"+n,e+"negz"+n];Yx3D.envMap=(new THREE.CubeTextureLoader).load(r);Yx3D.envMap.format=THREE.RGBFormat;return Yx3D.envMap};Yx3D.SetMatrial=function(e){};Yx3D.SetPartColor=function(n,e){var r=Yx3D.CurrModel.scene.children[0].children.find(function(e){return e.uuid==n});if(r){r.material.color=e;r.material.map=null;r.material.needsUpdate=true}};Yx3D.GetPart=function(n){return Yx3D.CurrModel.scene.children[0].children.find(function(e){return e.uuid==n})};Yx3D._mouse=new THREE.Vector2;Yx3D._raycaster=new THREE.Raycaster;Yx3D.onPick=function(e){alert(e.name)};Yx3D.Pick=function(e){if(Yx3D.CurrModel==undefined)return;if(Math.abs(e.offsetX-Yx3D._downX)>5||Math.abs(e.offsetY-Yx3D._downY)>5)return;Yx3D._mouse.x=e.offsetX/Yx3D.Container.clientWidth*2-1;Yx3D._mouse.y=-(e.offsetY/Yx3D.Container.clientHeight)*2+1;Yx3D._raycaster.setFromCamera(Yx3D._mouse,Yx3D.Camera);var n=Yx3D._raycaster.intersectObjects(Yx3D.CurrModel.scene.children[0].children,true);if(n.length>0){var r=n.find(function(e){return e.object.visible==true});if(r)Yx3D.onPick(r.object)}else return};Yx3D.SelectFx=function(e){console.log("select:"+Yx3D.GetObjPath(e));var n=e.material;var r=n.color;var a=createjs.Ease.getPowIn(2.2);createjs.Tween.get(n.color).to({r:1,g:0,b:0,a:1},200,a).wait(200).to({r:r.r,g:r.g,b:r.b,a:r.a},200,a)};Yx3D.GetObjPath=function(e){var n=e.name;var r=e.parent;while(r){n=r.name+"/"+n;r=r.parent}return n};Yx3D.ResetCamera=function(){this.CamerCtrl.reset()};