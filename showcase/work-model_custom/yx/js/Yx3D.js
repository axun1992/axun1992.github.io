var Yx3D={};Yx3D.Init=function(){Yx3D.Container=document.getElementById("Yx3D");Yx3D.Scene=new THREE.Scene;Yx3D.Camera=new THREE.PerspectiveCamera(45,Yx3D.Container.clientWidth/Yx3D.Container.clientHeight,.25,20);Yx3D.Camera.position.set(0,.6,5);Yx3D.Scene.add(Yx3D.Camera);Yx3D.Renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});Yx3D.Renderer.setClearAlpha(0);Yx3D.Renderer.setSize(Yx3D.Container.clientWidth,Yx3D.Container.clientHeight);Yx3D.Renderer.outputEncoding=THREE.sRGBEncoding;Yx3D.Renderer.shadowMap.enabled=true;Yx3D.Renderer.shadowMap.type=THREE.PCFSoftShadowMap;Yx3D.Container.appendChild(Yx3D.Renderer.domElement);Yx3D.CamerCtrl=new THREE.OrbitControls(Yx3D.Camera,Yx3D.Renderer.domElement);Yx3D.CamerCtrl.minDistance=2;Yx3D.CamerCtrl.maxDistance=15;Yx3D.CamerCtrl.target.set(0,0,0);window.addEventListener("resize",Yx3D.OnWindowResize);var e=new THREE.AmbientLight(16777215,.2);Yx3D.Scene.add(e);var r=new THREE.DirectionalLight(16777215,.6);r.position.set(0,0,1);r.rotation.set(0,0,90);Yx3D.Camera.add(r);var n=function(e){event.preventDefault();Yx3D._downX=e.offsetX;Yx3D._downY=e.offsetY};Yx3D.Renderer.domElement.addEventListener("mousedown",n,false);Yx3D.Renderer.domElement.addEventListener("click",Yx3D.Pick,false);Yx3D.Render()};Yx3D.OnWindowResize=function(){Yx3D.Camera.aspect=Yx3D.Container.clientWidth/Yx3D.Container.clientHeight;Yx3D.Camera.updateProjectionMatrix();Yx3D.Renderer.setSize(Yx3D.Container.clientWidth,Yx3D.Container.clientHeight)};Yx3D.Render=function(){requestAnimationFrame(Yx3D.Render);Yx3D.CamerCtrl.update();Yx3D.Renderer.render(Yx3D.Scene,Yx3D.Camera)};Yx3D.LoadModel=function(x,Y){if(Yx3D.CurrModel!=undefined){Yx3D.Scene.remove(Yx3D.CurrModel.scene);Yx3D.CurrModel=undefined}var e=new THREE.GLTFLoader;e.load(x,function(e){e.scene.children[0].scale.set(.1,.1,.1);Yx3D.CurrModel=e;var r=x+".tex/";var n=new THREE.TextureLoader;var a=n.load(r+"glove_color.jpg");a.flipY=false;var t=n.load(r+"glove_height.jpg");t.flipY=false;var i=n.load(r+"glove_metallic.jpg");i.flipY=false;var o=n.load(r+"glove_normal.jpg");o.flipY=false;var l=n.load(r+"glove_roughness.jpg");l.flipY=false;var d=Yx3D.GetEnvMap();Yx3D.CurrModel.scene.children[0].traverse(function(e){if(e.material&&(e.material.isMeshStandardMaterial||e.material.isShaderMaterial&&e.material.envMap!==undefined)){e.material.envMap=d;var r=new THREE.Color;r.setStyle("#ffffffff");e.material.color=r;e.material.map=a;e.material.bumpMap=t;e.material.metalnessMap=i;e.material.normalMap=o;e.material.roughnessMap=l;e.material.needsUpdate=true}});Yx3D.Scene.add(e.scene);Y(e)})};Yx3D.GetEnvMap=function(){if(Yx3D.envMap){return Yx3D.envMap}var e="./yx/res/cube/Park2/";var r=".jpg";var n=[e+"posx"+r,e+"negx"+r,e+"posy"+r,e+"negy"+r,e+"posz"+r,e+"negz"+r];Yx3D.envMap=(new THREE.CubeTextureLoader).load(n);Yx3D.envMap.format=THREE.RGBFormat;return Yx3D.envMap};Yx3D.SetMatrial=function(e){};Yx3D.SetPartColor=function(r,e){var n=Yx3D.CurrModel.scene.children[0].children.find(function(e){return e.uuid==r});if(n){n.material.color=e}};Yx3D.GetPart=function(r){return Yx3D.CurrModel.scene.children[0].children.find(function(e){return e.uuid==r})};Yx3D._mouse=new THREE.Vector2;Yx3D._raycaster=new THREE.Raycaster;Yx3D.onPick=function(e){alert(e.name)};Yx3D.Pick=function(e){if(Yx3D.CurrModel==undefined)return;if(Math.abs(e.offsetX-Yx3D._downX)>5||Math.abs(e.offsetY-Yx3D._downY)>5)return;Yx3D._mouse.x=e.offsetX/Yx3D.Container.clientWidth*2-1;Yx3D._mouse.y=-(e.offsetY/Yx3D.Container.clientHeight)*2+1;Yx3D._raycaster.setFromCamera(Yx3D._mouse,Yx3D.Camera);var r=Yx3D._raycaster.intersectObjects(Yx3D.CurrModel.scene.children[0].children,true);if(r.length>0){var n=r.find(function(e){return e.object.visible==true});if(n)Yx3D.onPick(n.object)}else return};Yx3D.SelectFx=function(e){console.log("select:"+Yx3D.GetObjPath(e));var r=e.material;var n=r.color;var a=createjs.Ease.getPowIn(2.2);createjs.Tween.get(r.color).to({r:1,g:0,b:0,a:1},200,a).wait(200).to({r:n.r,g:n.g,b:n.b,a:n.a},200,a)};Yx3D.GetObjPath=function(e){var r=e.name;var n=e.parent;while(n){r=n.name+"/"+r;n=n.parent}return r};Yx3D.ResetCamera=function(){this.CamerCtrl.reset()};