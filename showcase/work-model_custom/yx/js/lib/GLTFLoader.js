THREE.GLTFLoader=function(){function e(e){THREE.Loader.call(this,e);this.dracoLoader=null;this.ktx2Loader=null;this.meshoptDecoder=null;this.pluginCallbacks=[];this.register(function(e){return new n(e)});this.register(function(e){return new s(e)});this.register(function(e){return new i(e)});this.register(function(e){return new a(e)});this.register(function(e){return new r(e)});this.register(function(e){return new o(e)})}e.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:e,load:function(r,t,e,n){var a=this;var s;if(this.resourcePath!==""){s=this.resourcePath}else if(this.path!==""){s=this.path}else{s=THREE.LoaderUtils.extractUrlBase(r)}this.manager.itemStart(r);var i=function(e){if(n){n(e)}else{console.error(e)}a.manager.itemError(r);a.manager.itemEnd(r)};var o=new THREE.FileLoader(this.manager);o.setPath(this.path);o.setResponseType("arraybuffer");o.setRequestHeader(this.requestHeader);o.setWithCredentials(this.withCredentials);o.load(r,function(e){try{a.parse(e,s,function(e){t(e);a.manager.itemEnd(r)},i)}catch(e){i(e)}},e,i)},setDRACOLoader:function(e){this.dracoLoader=e;return this},setDDSLoader:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(e){this.ktx2Loader=e;return this},setMeshoptDecoder:function(e){this.meshoptDecoder=e;return this},register:function(e){if(this.pluginCallbacks.indexOf(e)===-1){this.pluginCallbacks.push(e)}return this},unregister:function(e){if(this.pluginCallbacks.indexOf(e)!==-1){this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1)}return this},parse:function(e,r,t,n){var a;var s={};var i={};if(typeof e==="string"){a=e}else{var o=THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4));if(o===v){try{s[h.KHR_BINARY_GLTF]=new E(e)}catch(e){if(n)n(e);return}a=s[h.KHR_BINARY_GLTF].content}else{a=THREE.LoaderUtils.decodeText(new Uint8Array(e))}}var u=JSON.parse(a);if(u.asset===undefined||u.asset.version[0]<2){if(n)n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}var l=new D(u,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(var f=0;f<this.pluginCallbacks.length;f++){var c=this.pluginCallbacks[f](l);i[c.name]=c;s[c.name]=true}if(u.extensionsUsed){for(var f=0;f<u.extensionsUsed.length;++f){var p=u.extensionsUsed[f];var d=u.extensionsRequired||[];switch(p){case h.KHR_MATERIALS_UNLIT:s[p]=new m;break;case h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[p]=new y;break;case h.KHR_DRACO_MESH_COMPRESSION:s[p]=new g(u,this.dracoLoader);break;case h.KHR_TEXTURE_TRANSFORM:s[p]=new T;break;case h.KHR_MESH_QUANTIZATION:s[p]=new x;break;default:if(d.indexOf(p)>=0&&i[p]===undefined){console.warn('THREE.GLTFLoader: Unknown extension "'+p+'".')}}}}l.setExtensions(s);l.setPlugins(i);l.parse(t,n)}});function t(){var t={};return{get:function(e){return t[e]},add:function(e,r){t[e]=r},remove:function(e){delete t[e]},removeAll:function(){t={}}}}var h={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};function r(e){this.parser=e;this.name=h.KHR_LIGHTS_PUNCTUAL;this.cache={refs:{},uses:{}}}r.prototype._markDefs=function(){var e=this.parser;var r=this.parser.json.nodes||[];for(var t=0,n=r.length;t<n;t++){var a=r[t];if(a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==undefined){e._addNodeRef(this.cache,a.extensions[this.name].light)}}};r.prototype._loadLight=function(e){var r=this.parser;var t="light:"+e;var n=r.cache.get(t);if(n)return n;var a=r.json;var s=a.extensions&&a.extensions[this.name]||{};var i=s.lights||[];var o=i[e];var u;var l=new THREE.Color(16777215);if(o.color!==undefined)l.fromArray(o.color);var f=o.range!==undefined?o.range:0;switch(o.type){case"directional":u=new THREE.DirectionalLight(l);u.target.position.set(0,0,-1);u.add(u.target);break;case"point":u=new THREE.PointLight(l);u.distance=f;break;case"spot":u=new THREE.SpotLight(l);u.distance=f;o.spot=o.spot||{};o.spot.innerConeAngle=o.spot.innerConeAngle!==undefined?o.spot.innerConeAngle:0;o.spot.outerConeAngle=o.spot.outerConeAngle!==undefined?o.spot.outerConeAngle:Math.PI/4;u.angle=o.spot.outerConeAngle;u.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle;u.target.position.set(0,0,-1);u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}u.position.set(0,0,0);u.decay=2;if(o.intensity!==undefined)u.intensity=o.intensity;u.name=r.createUniqueName(o.name||"light_"+e);n=Promise.resolve(u);r.cache.add(t,n);return n};r.prototype.createNodeAttachment=function(e){var r=this;var t=this.parser;var n=t.json;var a=n.nodes[e];var s=a.extensions&&a.extensions[this.name]||{};var i=s.light;if(i===undefined)return null;return this._loadLight(i).then(function(e){return t._getNodeRef(r.cache,i,e)})};function m(){this.name=h.KHR_MATERIALS_UNLIT}m.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial};m.prototype.extendParams=function(e,r,t){var n=[];e.color=new THREE.Color(1,1,1);e.opacity=1;var a=r.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){var s=a.baseColorFactor;e.color.fromArray(s);e.opacity=s[3]}if(a.baseColorTexture!==undefined){n.push(t.assignTexture(e,"map",a.baseColorTexture))}}return Promise.all(n)};function n(e){this.parser=e;this.name=h.KHR_MATERIALS_CLEARCOAT}n.prototype.getMaterialType=function(e){var r=this.parser;var t=r.json.materials[e];if(!t.extensions||!t.extensions[this.name])return null;return THREE.MeshPhysicalMaterial};n.prototype.extendMaterialParams=function(e,r){var t=this.parser;var n=t.json.materials[e];if(!n.extensions||!n.extensions[this.name]){return Promise.resolve()}var a=[];var s=n.extensions[this.name];if(s.clearcoatFactor!==undefined){r.clearcoat=s.clearcoatFactor}if(s.clearcoatTexture!==undefined){a.push(t.assignTexture(r,"clearcoatMap",s.clearcoatTexture))}if(s.clearcoatRoughnessFactor!==undefined){r.clearcoatRoughness=s.clearcoatRoughnessFactor}if(s.clearcoatRoughnessTexture!==undefined){a.push(t.assignTexture(r,"clearcoatRoughnessMap",s.clearcoatRoughnessTexture))}if(s.clearcoatNormalTexture!==undefined){a.push(t.assignTexture(r,"clearcoatNormalMap",s.clearcoatNormalTexture));if(s.clearcoatNormalTexture.scale!==undefined){var i=s.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new THREE.Vector2(i,-i)}}return Promise.all(a)};function a(e){this.parser=e;this.name=h.KHR_MATERIALS_TRANSMISSION}a.prototype.getMaterialType=function(e){var r=this.parser;var t=r.json.materials[e];if(!t.extensions||!t.extensions[this.name])return null;return THREE.MeshPhysicalMaterial};a.prototype.extendMaterialParams=function(e,r){var t=this.parser;var n=t.json.materials[e];if(!n.extensions||!n.extensions[this.name]){return Promise.resolve()}var a=[];var s=n.extensions[this.name];if(s.transmissionFactor!==undefined){r.transmission=s.transmissionFactor}if(s.transmissionTexture!==undefined){a.push(t.assignTexture(r,"transmissionMap",s.transmissionTexture))}return Promise.all(a)};function s(e){this.parser=e;this.name=h.KHR_TEXTURE_BASISU}s.prototype.loadTexture=function(e){var r=this.parser;var t=r.json;var n=t.textures[e];if(!n.extensions||!n.extensions[this.name]){return null}var a=n.extensions[this.name];var s=t.images[a.source];var i=r.options.ktx2Loader;if(!i){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0){throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}else{return null}}return r.loadTextureImage(e,s,i)};function i(e){this.parser=e;this.name=h.EXT_TEXTURE_WEBP;this.isSupported=null}i.prototype.loadTexture=function(r){var t=this.name;var n=this.parser;var a=n.json;var e=a.textures[r];if(!e.extensions||!e.extensions[t]){return null}var s=e.extensions[t];var i=a.images[s.source];var o=n.textureLoader;if(i.uri){var u=n.options.manager.getHandler(i.uri);if(u!==null)o=u}return this.detectSupport().then(function(e){if(e)return n.loadTextureImage(r,i,o);if(a.extensionsRequired&&a.extensionsRequired.indexOf(t)>=0){throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.")}return n.loadTexture(r)})};i.prototype.detectSupport=function(){if(!this.isSupported){this.isSupported=new Promise(function(e){var r=new Image;r.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA";r.onload=r.onerror=function(){e(r.height===1)}})}return this.isSupported};function o(e){this.name=h.EXT_MESHOPT_COMPRESSION;this.parser=e}o.prototype.loadBufferView=function(e){var r=this.parser.json;var t=r.bufferViews[e];if(t.extensions&&t.extensions[this.name]){var o=t.extensions[this.name];var n=this.parser.getDependency("buffer",o.buffer);var u=this.parser.options.meshoptDecoder;if(!u||!u.supported){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0){throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}else{return null}}return Promise.all([n,u.ready]).then(function(e){var r=o.byteOffset||0;var t=o.byteLength||0;var n=o.count;var a=o.byteStride;var s=new ArrayBuffer(n*a);var i=new Uint8Array(e[0],r,t);u.decodeGltfBuffer(new Uint8Array(s),n,a,i,o.mode,o.filter);return s})}else{return null}};var v="glTF";var l=12;var f={JSON:1313821514,BIN:5130562};function E(e){this.name=h.KHR_BINARY_GLTF;this.content=null;this.body=null;var r=new DataView(e,0,l);this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,true),length:r.getUint32(8,true)};if(this.header.magic!==v){throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.")}else if(this.header.version<2){throw new Error("THREE.GLTFLoader: Legacy binary file detected.")}var t=this.header.length-l;var n=new DataView(e,l);var a=0;while(a<t){var s=n.getUint32(a,true);a+=4;var i=n.getUint32(a,true);a+=4;if(i===f.JSON){var o=new Uint8Array(e,l+a,s);this.content=THREE.LoaderUtils.decodeText(o)}else if(i===f.BIN){var u=l+a;this.body=e.slice(u,u+s)}a+=s}if(this.content===null){throw new Error("THREE.GLTFLoader: JSON content not found.")}}function g(e,r){if(!r){throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.")}this.name=h.KHR_DRACO_MESH_COMPRESSION;this.json=e;this.dracoLoader=r;this.dracoLoader.preload()}g.prototype.decodePrimitive=function(e,r){var t=this.json;var n=this.dracoLoader;var a=e.extensions[this.name].bufferView;var s=e.extensions[this.name].attributes;var i={};var o={};var u={};for(var l in s){var f=d[l]||l.toLowerCase();i[f]=s[l]}for(l in e.attributes){var f=d[l]||l.toLowerCase();if(s[l]!==undefined){var c=t.accessors[e.attributes[l]];var p=L[c.componentType];u[f]=p;o[f]=c.normalized===true}}return r.getDependency("bufferView",a).then(function(e){return new Promise(function(a){n.decodeDracoFile(e,function(e){for(var r in e.attributes){var t=e.attributes[r];var n=o[r];if(n!==undefined)t.normalized=n}a(e)},i,u)})})};function T(){this.name=h.KHR_TEXTURE_TRANSFORM}T.prototype.extendTexture=function(e,r){e=e.clone();if(r.offset!==undefined){e.offset.fromArray(r.offset)}if(r.rotation!==undefined){e.rotation=r.rotation}if(r.scale!==undefined){e.repeat.fromArray(r.scale)}if(r.texCoord!==undefined){console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.')}e.needsUpdate=true;return e};function R(e){THREE.MeshStandardMaterial.call(this);this.isGLTFSpecularGlossinessMaterial=true;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n");var n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n");var a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n");var s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n");var i=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n");var o={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o;this.onBeforeCompile=function(e){for(var r in o){e.uniforms[r]=o[r]}e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",i)};Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e;if(e){this.defines.USE_SPECULARMAP=""}else{delete this.defines.USE_SPECULARMAP}}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e;if(e){this.defines.USE_GLOSSINESSMAP="";this.defines.USE_UV=""}else{delete this.defines.USE_GLOSSINESSMAP;delete this.defines.USE_UV}}}});delete this.metalness;delete this.roughness;delete this.metalnessMap;delete this.roughnessMap;this.setValues(e)}R.prototype=Object.create(THREE.MeshStandardMaterial.prototype);R.prototype.constructor=R;R.prototype.copy=function(e){THREE.MeshStandardMaterial.prototype.copy.call(this,e);this.specularMap=e.specularMap;this.specular.copy(e.specular);this.glossinessMap=e.glossinessMap;this.glossiness=e.glossiness;delete this.metalness;delete this.roughness;delete this.metalnessMap;delete this.roughnessMap;return this};function y(){return{name:h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return R},extendParams:function(e,r,t){var n=r.extensions[this.name];e.color=new THREE.Color(1,1,1);e.opacity=1;var a=[];if(Array.isArray(n.diffuseFactor)){var s=n.diffuseFactor;e.color.fromArray(s);e.opacity=s[3]}if(n.diffuseTexture!==undefined){a.push(t.assignTexture(e,"map",n.diffuseTexture))}e.emissive=new THREE.Color(0,0,0);e.glossiness=n.glossinessFactor!==undefined?n.glossinessFactor:1;e.specular=new THREE.Color(1,1,1);if(Array.isArray(n.specularFactor)){e.specular.fromArray(n.specularFactor)}if(n.specularGlossinessTexture!==undefined){var i=n.specularGlossinessTexture;a.push(t.assignTexture(e,"glossinessMap",i));a.push(t.assignTexture(e,"specularMap",i))}return Promise.all(a)},createMaterial:function(e){var r=new R(e);r.fog=true;r.color=e.color;r.map=e.map===undefined?null:e.map;r.lightMap=null;r.lightMapIntensity=1;r.aoMap=e.aoMap===undefined?null:e.aoMap;r.aoMapIntensity=1;r.emissive=e.emissive;r.emissiveIntensity=1;r.emissiveMap=e.emissiveMap===undefined?null:e.emissiveMap;r.bumpMap=e.bumpMap===undefined?null:e.bumpMap;r.bumpScale=1;r.normalMap=e.normalMap===undefined?null:e.normalMap;r.normalMapType=THREE.TangentSpaceNormalMap;if(e.normalScale)r.normalScale=e.normalScale;r.displacementMap=null;r.displacementScale=1;r.displacementBias=0;r.specularMap=e.specularMap===undefined?null:e.specularMap;r.specular=e.specular;r.glossinessMap=e.glossinessMap===undefined?null:e.glossinessMap;r.glossiness=e.glossiness;r.alphaMap=null;r.envMap=e.envMap===undefined?null:e.envMap;r.envMapIntensity=1;r.refractionRatio=.98;return r}}}function x(){this.name=h.KHR_MESH_QUANTIZATION}function _(e,r,t,n){THREE.Interpolant.call(this,e,r,t,n)}_.prototype=Object.create(THREE.Interpolant.prototype);_.prototype.constructor=_;_.prototype.copySampleValue_=function(e){var r=this.resultBuffer,t=this.sampleValues,n=this.valueSize,a=e*n*3+n;for(var s=0;s!==n;s++){r[s]=t[a+s]}return r};_.prototype.beforeStart_=_.prototype.copySampleValue_;_.prototype.afterEnd_=_.prototype.copySampleValue_;_.prototype.interpolate_=function(e,r,t,n){var a=this.resultBuffer;var s=this.sampleValues;var i=this.valueSize;var o=i*2;var u=i*3;var l=n-r;var f=(t-r)/l;var c=f*f;var p=c*f;var d=e*u;var h=d-u;var m=-2*p+3*c;var v=p-c;var E=1-m;var g=v-c+f;for(var T=0;T!==i;T++){var R=s[h+T+i];var y=s[h+T+o]*l;var x=s[d+T+i];var M=s[d+T]*l;a[T]=E*R+g*y+m*x+v*M}return a};var M={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123};var L={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var S={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter};var A={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping};var H={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};var d={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"};var w={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"};var b={CUBICSPLINE:undefined,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete};var I={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function N(e,r){if(typeof e!=="string"||e==="")return"";if(/^https?:\/\//i.test(r)&&/^\//.test(e)){r=r.replace(/(^https?:\/\/[^\/]+).*/i,"$1")}if(/^(https?:)?\/\//i.test(e))return e;if(/^data:.*,.*$/i.test(e))return e;if(/^blob:.*$/i.test(e))return e;return r+e}function u(e){if(e["DefaultMaterial"]===undefined){e["DefaultMaterial"]=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:false,depthTest:true,side:THREE.FrontSide})}return e["DefaultMaterial"]}function P(e,r,t){for(var n in t.extensions){if(e[n]===undefined){r.userData.gltfExtensions=r.userData.gltfExtensions||{};r.userData.gltfExtensions[n]=t.extensions[n]}}}function O(e,r){if(r.extras!==undefined){if(typeof r.extras==="object"){Object.assign(e.userData,r.extras)}else{console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+r.extras)}}}function c(n,e,r){var a=false;var s=false;for(var t=0,i=e.length;t<i;t++){var o=e[t];if(o.POSITION!==undefined)a=true;if(o.NORMAL!==undefined)s=true;if(a&&s)break}if(!a&&!s)return Promise.resolve(n);var u=[];var l=[];for(var t=0,i=e.length;t<i;t++){var o=e[t];if(a){var f=o.POSITION!==undefined?r.getDependency("accessor",o.POSITION):n.attributes.position;u.push(f)}if(s){var f=o.NORMAL!==undefined?r.getDependency("accessor",o.NORMAL):n.attributes.normal;l.push(f)}}return Promise.all([Promise.all(u),Promise.all(l)]).then(function(e){var r=e[0];var t=e[1];if(a)n.morphAttributes.position=r;if(s)n.morphAttributes.normal=t;n.morphTargetsRelative=true;return n})}function C(e,r){e.updateMorphTargets();if(r.weights!==undefined){for(var t=0,n=r.weights.length;t<n;t++){e.morphTargetInfluences[t]=r.weights[t]}}if(r.extras&&Array.isArray(r.extras.targetNames)){var a=r.extras.targetNames;if(e.morphTargetInfluences.length===a.length){e.morphTargetDictionary={};for(var t=0,n=a.length;t<n;t++){e.morphTargetDictionary[a[t]]=t}}else{console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}}function p(e){var r=e.extensions&&e.extensions[h.KHR_DRACO_MESH_COMPRESSION];var t;if(r){t="draco:"+r.bufferView+":"+r.indices+":"+F(r.attributes)}else{t=e.indices+":"+F(e.attributes)+":"+e.mode}return t}function F(e){var r="";var t=Object.keys(e).sort();for(var n=0,a=t.length;n<a;n++){r+=t[n]+":"+e[t[n]]+";"}return r}function U(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function D(e,r){this.json=e||{};this.extensions={};this.plugins={};this.options=r||{};this.cache=new t;this.associations=new Map;this.primitiveCache={};this.meshCache={refs:{},uses:{}};this.cameraCache={refs:{},uses:{}};this.lightCache={refs:{},uses:{}};this.nodeNamesUsed={};if(typeof createImageBitmap!=="undefined"&&/Firefox/.test(navigator.userAgent)===false){this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager)}else{this.textureLoader=new THREE.TextureLoader(this.options.manager)}this.textureLoader.setCrossOrigin(this.options.crossOrigin);this.textureLoader.setRequestHeader(this.options.requestHeader);this.fileLoader=new THREE.FileLoader(this.options.manager);this.fileLoader.setResponseType("arraybuffer");if(this.options.crossOrigin==="use-credentials"){this.fileLoader.setWithCredentials(true)}}D.prototype.setExtensions=function(e){this.extensions=e};D.prototype.setPlugins=function(e){this.plugins=e};D.prototype.parse=function(t,e){var n=this;var a=this.json;var s=this.extensions;this.cache.removeAll();this._invokeAll(function(e){return e._markDefs&&e._markDefs()});Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(e){var r={scene:e[0][a.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:a.asset,parser:n,userData:{}};P(s,r,a);O(r,a);Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(r)})).then(function(){t(r)})}).catch(e)};D.prototype._markDefs=function(){var e=this.json.nodes||[];var r=this.json.skins||[];var t=this.json.meshes||[];for(var n=0,a=r.length;n<a;n++){var s=r[n].joints;for(var i=0,o=s.length;i<o;i++){e[s[i]].isBone=true}}for(var u=0,l=e.length;u<l;u++){var f=e[u];if(f.mesh!==undefined){this._addNodeRef(this.meshCache,f.mesh);if(f.skin!==undefined){t[f.mesh].isSkinnedMesh=true}}if(f.camera!==undefined){this._addNodeRef(this.cameraCache,f.camera)}}};D.prototype._addNodeRef=function(e,r){if(r===undefined)return;if(e.refs[r]===undefined){e.refs[r]=e.uses[r]=0}e.refs[r]++};D.prototype._getNodeRef=function(e,r,t){if(e.refs[r]<=1)return t;var n=t.clone();n.name+="_instance_"+e.uses[r]++;return n};D.prototype._invokeOne=function(e){var r=Object.values(this.plugins);r.push(this);for(var t=0;t<r.length;t++){var n=e(r[t]);if(n)return n}};D.prototype._invokeAll=function(e){var r=Object.values(this.plugins);r.unshift(this);var t=[];for(var n=0;n<r.length;n++){var a=e(r[n]);if(a)t.push(a)}return t};D.prototype.getDependency=function(e,r){var t=e+":"+r;var n=this.cache.get(t);if(!n){switch(e){case"scene":n=this.loadScene(r);break;case"node":n=this.loadNode(r);break;case"mesh":n=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(r)});break;case"accessor":n=this.loadAccessor(r);break;case"bufferView":n=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(r)});break;case"buffer":n=this.loadBuffer(r);break;case"material":n=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(r)});break;case"texture":n=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(r)});break;case"skin":n=this.loadSkin(r);break;case"animation":n=this.loadAnimation(r);break;case"camera":n=this.loadCamera(r);break;default:throw new Error("Unknown type: "+e)}this.cache.add(t,n)}return n};D.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var n=this;var r=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(r.map(function(e,r){return n.getDependency(t,r)}));this.cache.add(t,e)}return e};D.prototype.loadBuffer=function(e){var t=this.json.buffers[e];var n=this.fileLoader;if(t.type&&t.type!=="arraybuffer"){throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.")}if(t.uri===undefined&&e===0){return Promise.resolve(this.extensions[h.KHR_BINARY_GLTF].body)}var a=this.options;return new Promise(function(e,r){n.load(N(t.uri,a.path),e,undefined,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})};D.prototype.loadBufferView=function(e){var n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(e){var r=n.byteLength||0;var t=n.byteOffset||0;return e.slice(t,t+r)})};D.prototype.loadAccessor=function(e){var M=this;var S=this.json;var A=this.json.accessors[e];if(A.bufferView===undefined&&A.sparse===undefined){return Promise.resolve(null)}var r=[];if(A.bufferView!==undefined){r.push(this.getDependency("bufferView",A.bufferView))}else{r.push(null)}if(A.sparse!==undefined){r.push(this.getDependency("bufferView",A.sparse.indices.bufferView));r.push(this.getDependency("bufferView",A.sparse.values.bufferView))}return Promise.all(r).then(function(e){var r=e[0];var t=H[A.type];var n=L[A.componentType];var a=n.BYTES_PER_ELEMENT;var s=a*t;var i=A.byteOffset||0;var o=A.bufferView!==undefined?S.bufferViews[A.bufferView].byteStride:undefined;var u=A.normalized===true;var l,f;if(o&&o!==s){var c=Math.floor(i/o);var p="InterleavedBuffer:"+A.bufferView+":"+A.componentType+":"+c+":"+A.count;var d=M.cache.get(p);if(!d){l=new n(r,c*o,A.count*o/a);d=new THREE.InterleavedBuffer(l,o/a);M.cache.add(p,d)}f=new THREE.InterleavedBufferAttribute(d,t,i%o/a,u)}else{if(r===null){l=new n(A.count*t)}else{l=new n(r,i,A.count*t)}f=new THREE.BufferAttribute(l,t,u)}if(A.sparse!==undefined){var h=H.SCALAR;var m=L[A.sparse.indices.componentType];var v=A.sparse.indices.byteOffset||0;var E=A.sparse.values.byteOffset||0;var g=new m(e[1],v,A.sparse.count*h);var T=new n(e[2],E,A.sparse.count*t);if(r!==null){f=new THREE.BufferAttribute(f.array.slice(),f.itemSize,f.normalized)}for(var R=0,y=g.length;R<y;R++){var x=g[R];f.setX(x,T[R*t]);if(t>=2)f.setY(x,T[R*t+1]);if(t>=3)f.setZ(x,T[R*t+2]);if(t>=4)f.setW(x,T[R*t+3]);if(t>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f})};D.prototype.loadTexture=function(e){var r=this.json;var t=this.options;var n=r.textures[e];var a=r.images[n.source];var s=this.textureLoader;if(a.uri){var i=t.manager.getHandler(a.uri);if(i!==null)s=i}return this.loadTextureImage(e,a,s)};D.prototype.loadTextureImage=function(n,a,s){var i=this;var o=this.json;var u=this.options;var l=o.textures[n];var f=self.URL||self.webkitURL;var c=a.uri;var p=false;var d=true;if(a.mimeType==="image/jpeg")d=false;if(a.bufferView!==undefined){c=i.getDependency("bufferView",a.bufferView).then(function(e){if(a.mimeType==="image/png"){var r=new DataView(e,25,1).getUint8(0,false);d=r===6||r===4||r===3}p=true;var t=new Blob([e],{type:a.mimeType});c=f.createObjectURL(t);return c})}else if(a.uri===undefined){throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView")}return Promise.resolve(c).then(function(n){return new Promise(function(r,e){var t=r;if(s.isImageBitmapLoader===true){t=function(e){r(new THREE.CanvasTexture(e))}}s.load(N(n,u.path),t,undefined,e)})}).then(function(e){if(p===true){f.revokeObjectURL(c)}e.flipY=false;if(l.name)e.name=l.name;if(!d)e.format=THREE.RGBFormat;var r=o.samplers||{};var t=r[l.sampler]||{};e.magFilter=S[t.magFilter]||THREE.LinearFilter;e.minFilter=S[t.minFilter]||THREE.LinearMipmapLinearFilter;e.wrapS=A[t.wrapS]||THREE.RepeatWrapping;e.wrapT=A[t.wrapT]||THREE.RepeatWrapping;i.associations.set(e,{type:"textures",index:n});return e})};D.prototype.assignTexture=function(n,a,s){var i=this;return this.getDependency("texture",s.index).then(function(e){if(s.texCoord!==undefined&&s.texCoord!=0&&!(a==="aoMap"&&s.texCoord==1)){console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+a+" not yet supported.")}if(i.extensions[h.KHR_TEXTURE_TRANSFORM]){var r=s.extensions!==undefined?s.extensions[h.KHR_TEXTURE_TRANSFORM]:undefined;if(r){var t=i.associations.get(e);e=i.extensions[h.KHR_TEXTURE_TRANSFORM].extendTexture(e,r);i.associations.set(e,t)}}n[a]=e})};D.prototype.assignFinalMaterial=function(e){var r=e.geometry;var t=e.material;var n=r.attributes.tangent!==undefined;var a=r.attributes.color!==undefined;var s=r.attributes.normal===undefined;var i=e.isSkinnedMesh===true;var o=Object.keys(r.morphAttributes).length>0;var u=o&&r.morphAttributes.normal!==undefined;if(e.isPoints){var l="PointsMaterial:"+t.uuid;var f=this.cache.get(l);if(!f){f=new THREE.PointsMaterial;THREE.Material.prototype.copy.call(f,t);f.color.copy(t.color);f.map=t.map;f.sizeAttenuation=false;this.cache.add(l,f)}t=f}else if(e.isLine){var l="LineBasicMaterial:"+t.uuid;var c=this.cache.get(l);if(!c){c=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(c,t);c.color.copy(t.color);this.cache.add(l,c)}t=c}if(n||a||s||i||o){var l="ClonedMaterial:"+t.uuid+":";if(t.isGLTFSpecularGlossinessMaterial)l+="specular-glossiness:";if(i)l+="skinning:";if(n)l+="vertex-tangents:";if(a)l+="vertex-colors:";if(s)l+="flat-shading:";if(o)l+="morph-targets:";if(u)l+="morph-normals:";var p=this.cache.get(l);if(!p){p=t.clone();if(i)p.skinning=true;if(a)p.vertexColors=true;if(s)p.flatShading=true;if(o)p.morphTargets=true;if(u)p.morphNormals=true;if(n){p.vertexTangents=true;if(p.normalScale)p.normalScale.y*=-1;if(p.clearcoatNormalScale)p.clearcoatNormalScale.y*=-1}this.cache.add(l,p);this.associations.set(p,this.associations.get(t))}t=p}if(t.aoMap&&r.attributes.uv2===undefined&&r.attributes.uv!==undefined){r.setAttribute("uv2",r.attributes.uv)}e.material=t};D.prototype.getMaterialType=function(){return THREE.MeshStandardMaterial};D.prototype.loadMaterial=function(r){var t=this;var e=this.json;var n=this.extensions;var a=e.materials[r];var s;var i={};var o=a.extensions||{};var u=[];if(o[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=n[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=l.getMaterialType();u.push(l.extendParams(i,a,t))}else if(o[h.KHR_MATERIALS_UNLIT]){var f=n[h.KHR_MATERIALS_UNLIT];s=f.getMaterialType();u.push(f.extendParams(i,a,t))}else{var c=a.pbrMetallicRoughness||{};i.color=new THREE.Color(1,1,1);i.opacity=1;if(Array.isArray(c.baseColorFactor)){var p=c.baseColorFactor;i.color.fromArray(p);i.opacity=p[3]}if(c.baseColorTexture!==undefined){u.push(t.assignTexture(i,"map",c.baseColorTexture))}i.metalness=c.metallicFactor!==undefined?c.metallicFactor:1;i.roughness=c.roughnessFactor!==undefined?c.roughnessFactor:1;if(c.metallicRoughnessTexture!==undefined){u.push(t.assignTexture(i,"metalnessMap",c.metallicRoughnessTexture));u.push(t.assignTexture(i,"roughnessMap",c.metallicRoughnessTexture))}s=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(r)});u.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(r,i)})))}if(a.doubleSided===true){i.side=THREE.DoubleSide}var d=a.alphaMode||I.OPAQUE;if(d===I.BLEND){i.transparent=true;i.depthWrite=false}else{i.transparent=false;if(d===I.MASK){i.alphaTest=a.alphaCutoff!==undefined?a.alphaCutoff:.5}}if(a.normalTexture!==undefined&&s!==THREE.MeshBasicMaterial){u.push(t.assignTexture(i,"normalMap",a.normalTexture));i.normalScale=new THREE.Vector2(1,-1);if(a.normalTexture.scale!==undefined){i.normalScale.set(a.normalTexture.scale,-a.normalTexture.scale)}}if(a.occlusionTexture!==undefined&&s!==THREE.MeshBasicMaterial){u.push(t.assignTexture(i,"aoMap",a.occlusionTexture));if(a.occlusionTexture.strength!==undefined){i.aoMapIntensity=a.occlusionTexture.strength}}if(a.emissiveFactor!==undefined&&s!==THREE.MeshBasicMaterial){i.emissive=(new THREE.Color).fromArray(a.emissiveFactor)}if(a.emissiveTexture!==undefined&&s!==THREE.MeshBasicMaterial){u.push(t.assignTexture(i,"emissiveMap",a.emissiveTexture))}return Promise.all(u).then(function(){var e;if(s===R){e=n[h.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i)}else{e=new s(i)}if(a.name)e.name=a.name;if(e.map)e.map.encoding=THREE.sRGBEncoding;if(e.emissiveMap)e.emissiveMap.encoding=THREE.sRGBEncoding;O(e,a);t.associations.set(e,{type:"materials",index:r});if(a.extensions)P(n,e,a);return e})};D.prototype.createUniqueName=function(e){var r=THREE.PropertyBinding.sanitizeNodeName(e||"");var t=r;for(var n=1;this.nodeNamesUsed[t];++n){t=r+"_"+n}this.nodeNamesUsed[t]=true;return t};function G(e,r,t){var n=r.attributes;var a=new THREE.Box3;if(n.POSITION!==undefined){var s=t.json.accessors[n.POSITION];var i=s.min;var o=s.max;if(i!==undefined&&o!==undefined){a.set(new THREE.Vector3(i[0],i[1],i[2]),new THREE.Vector3(o[0],o[1],o[2]));if(s.normalized){var u=U(L[s.componentType]);a.min.multiplyScalar(u);a.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else{return}var l=r.targets;if(l!==undefined){var f=new THREE.Vector3;var c=new THREE.Vector3;for(var p=0,d=l.length;p<d;p++){var h=l[p];if(h.POSITION!==undefined){var s=t.json.accessors[h.POSITION];var i=s.min;var o=s.max;if(i!==undefined&&o!==undefined){c.setX(Math.max(Math.abs(i[0]),Math.abs(o[0])));c.setY(Math.max(Math.abs(i[1]),Math.abs(o[1])));c.setZ(Math.max(Math.abs(i[2]),Math.abs(o[2])));if(s.normalized){var u=U(L[s.componentType]);c.multiplyScalar(u)}f.max(c)}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}}a.expandByVector(f)}e.boundingBox=a;var m=new THREE.Sphere;a.getCenter(m.center);m.radius=a.min.distanceTo(a.max)/2;e.boundingSphere=m}function k(t,e,n){var r=e.attributes;var a=[];function s(e,r){return n.getDependency("accessor",e).then(function(e){t.setAttribute(r,e)})}for(var i in r){var o=d[i]||i.toLowerCase();if(o in t.attributes)continue;a.push(s(r[i],o))}if(e.indices!==undefined&&!t.index){var u=n.getDependency("accessor",e.indices).then(function(e){t.setIndex(e)});a.push(u)}O(t,e);G(t,e,n);return Promise.all(a).then(function(){return e.targets!==undefined?c(t,e.targets,n):t})}function B(e,r){var t=e.getIndex();if(t===null){var n=[];var a=e.getAttribute("position");if(a!==undefined){for(var s=0;s<a.count;s++){n.push(s)}e.setIndex(n);t=e.getIndex()}else{console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.");return e}}var i=t.count-2;var o=[];if(r===THREE.TriangleFanDrawMode){for(var s=1;s<=i;s++){o.push(t.getX(0));o.push(t.getX(s));o.push(t.getX(s+1))}}else{for(var s=0;s<i;s++){if(s%2===0){o.push(t.getX(s));o.push(t.getX(s+1));o.push(t.getX(s+2))}else{o.push(t.getX(s+2));o.push(t.getX(s+1));o.push(t.getX(s))}}}if(o.length/3!==i){console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.")}var u=e.clone();u.setIndex(o);return u}D.prototype.loadGeometries=function(e){var t=this;var n=this.extensions;var r=this.primitiveCache;function a(r){return n[h.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,t).then(function(e){return k(e,r,t)})}var s=[];for(var i=0,o=e.length;i<o;i++){var u=e[i];var l=p(u);var f=r[l];if(f){s.push(f.promise)}else{var c;if(u.extensions&&u.extensions[h.KHR_DRACO_MESH_COMPRESSION]){c=a(u)}else{c=k(new THREE.BufferGeometry,u,t)}r[l]={primitive:u,promise:c};s.push(c)}}return Promise.all(s)};D.prototype.loadMesh=function(c){var p=this;var e=this.json;var d=this.extensions;var h=e.meshes[c];var m=h.primitives;var r=[];for(var t=0,n=m.length;t<n;t++){var a=m[t].material===undefined?u(this.cache):this.getDependency("material",m[t].material);r.push(a)}r.push(p.loadGeometries(m));return Promise.all(r).then(function(e){var r=e.slice(0,e.length-1);var t=e[e.length-1];var n=[];for(var a=0,s=t.length;a<s;a++){var i=t[a];var o=m[a];var u;var l=r[a];if(o.mode===M.TRIANGLES||o.mode===M.TRIANGLE_STRIP||o.mode===M.TRIANGLE_FAN||o.mode===undefined){u=h.isSkinnedMesh===true?new THREE.SkinnedMesh(i,l):new THREE.Mesh(i,l);if(u.isSkinnedMesh===true&&!u.geometry.attributes.skinWeight.normalized){u.normalizeSkinWeights()}if(o.mode===M.TRIANGLE_STRIP){u.geometry=B(u.geometry,THREE.TriangleStripDrawMode)}else if(o.mode===M.TRIANGLE_FAN){u.geometry=B(u.geometry,THREE.TriangleFanDrawMode)}}else if(o.mode===M.LINES){u=new THREE.LineSegments(i,l)}else if(o.mode===M.LINE_STRIP){u=new THREE.Line(i,l)}else if(o.mode===M.LINE_LOOP){u=new THREE.LineLoop(i,l)}else if(o.mode===M.POINTS){u=new THREE.Points(i,l)}else{throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+o.mode)}if(Object.keys(u.geometry.morphAttributes).length>0){C(u,h)}u.name=p.createUniqueName(h.name||"mesh_"+c);O(u,h);if(o.extensions)P(d,u,o);p.assignFinalMaterial(u);n.push(u)}if(n.length===1){return n[0]}var f=new THREE.Group;for(var a=0,s=n.length;a<s;a++){f.add(n[a])}return f})};D.prototype.loadCamera=function(e){var r;var t=this.json.cameras[e];var n=t[t.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}if(t.type==="perspective"){r=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6)}else if(t.type==="orthographic"){r=new THREE.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)}if(t.name)r.name=this.createUniqueName(t.name);O(r,t);return Promise.resolve(r)};D.prototype.loadSkin=function(e){var r=this.json.skins[e];var t={joints:r.joints};if(r.inverseBindMatrices===undefined){return Promise.resolve(t)}return this.getDependency("accessor",r.inverseBindMatrices).then(function(e){t.inverseBindMatrices=e;return t})};D.prototype.loadAnimation=function(A){var e=this.json;var L=e.animations[A];var r=[];var t=[];var n=[];var a=[];var s=[];for(var i=0,o=L.channels.length;i<o;i++){var u=L.channels[i];var l=L.samplers[u.sampler];var f=u.target;var c=f.node!==undefined?f.node:f.id;var p=L.parameters!==undefined?L.parameters[l.input]:l.input;var d=L.parameters!==undefined?L.parameters[l.output]:l.output;r.push(this.getDependency("node",c));t.push(this.getDependency("accessor",p));n.push(this.getDependency("accessor",d));a.push(l);s.push(f)}return Promise.all([Promise.all(r),Promise.all(t),Promise.all(n),Promise.all(a),Promise.all(s)]).then(function(e){var r=e[0];var t=e[1];var n=e[2];var a=e[3];var s=e[4];var i=[];for(var o=0,u=r.length;o<u;o++){var l=r[o];var f=t[o];var c=n[o];var p=a[o];var d=s[o];if(l===undefined)continue;l.updateMatrix();l.matrixAutoUpdate=true;var h;switch(w[d.path]){case w.weights:h=THREE.NumberKeyframeTrack;break;case w.rotation:h=THREE.QuaternionKeyframeTrack;break;case w.position:case w.scale:default:h=THREE.VectorKeyframeTrack;break}var m=l.name?l.name:l.uuid;var v=p.interpolation!==undefined?b[p.interpolation]:THREE.InterpolateLinear;var E=[];if(w[d.path]===w.weights){l.traverse(function(e){if(e.isMesh===true&&e.morphTargetInfluences){E.push(e.name?e.name:e.uuid)}})}else{E.push(m)}var g=c.array;if(c.normalized){var T=U(g.constructor);var R=new Float32Array(g.length);for(var y=0,x=g.length;y<x;y++){R[y]=g[y]*T}g=R}for(var y=0,x=E.length;y<x;y++){var M=new h(E[y]+"."+w[d.path],f.array,g,v);if(p.interpolation==="CUBICSPLINE"){M.createInterpolant=function e(r){return new _(this.times,this.values,this.getValueSize()/3,r)};M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=true}i.push(M)}}var S=L.name?L.name:"animation_"+A;return new THREE.AnimationClip(S,undefined,i)})};D.prototype.loadNode=function(s){var e=this.json;var i=this.extensions;var o=this;var u=e.nodes[s];var l=u.name?o.createUniqueName(u.name):"";return function(){var r=[];if(u.mesh!==undefined){r.push(o.getDependency("mesh",u.mesh).then(function(e){var r=o._getNodeRef(o.meshCache,u.mesh,e);if(u.weights!==undefined){r.traverse(function(e){if(!e.isMesh)return;for(var r=0,t=u.weights.length;r<t;r++){e.morphTargetInfluences[r]=u.weights[r]}})}return r}))}if(u.camera!==undefined){r.push(o.getDependency("camera",u.camera).then(function(e){return o._getNodeRef(o.cameraCache,u.camera,e)}))}o._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(s)}).forEach(function(e){r.push(e)});return Promise.all(r)}().then(function(e){var r;if(u.isBone===true){r=new THREE.Bone}else if(e.length>1){r=new THREE.Group}else if(e.length===1){r=e[0]}else{r=new THREE.Object3D}if(r!==e[0]){for(var t=0,n=e.length;t<n;t++){r.add(e[t])}}if(u.name){r.userData.name=u.name;r.name=l}O(r,u);if(u.extensions)P(i,r,u);if(u.matrix!==undefined){var a=new THREE.Matrix4;a.fromArray(u.matrix);r.applyMatrix4(a)}else{if(u.translation!==undefined){r.position.fromArray(u.translation)}if(u.rotation!==undefined){r.quaternion.fromArray(u.rotation)}if(u.scale!==undefined){r.scale.fromArray(u.scale)}}o.associations.set(r,{type:"nodes",index:s});return r})};D.prototype.loadScene=function(){function c(e,i,o,l){var f=o.nodes[e];return l.getDependency("node",e).then(function(e){if(f.skin===undefined)return e;var u;return l.getDependency("skin",f.skin).then(function(e){u=e;var r=[];for(var t=0,n=u.joints.length;t<n;t++){r.push(l.getDependency("node",u.joints[t]))}return Promise.all(r)}).then(function(o){e.traverse(function(e){if(!e.isMesh)return;var r=[];var t=[];for(var n=0,a=o.length;n<a;n++){var s=o[n];if(s){r.push(s);var i=new THREE.Matrix4;if(u.inverseBindMatrices!==undefined){i.fromArray(u.inverseBindMatrices.array,n*16)}t.push(i)}else{console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',u.joints[n])}}e.bind(new THREE.Skeleton(r,t),e.matrixWorld)});return e})}).then(function(e){i.add(e);var r=[];if(f.children){var t=f.children;for(var n=0,a=t.length;n<a;n++){var s=t[n];r.push(c(s,e,o,l))}}return Promise.all(r)})}return function e(r){var t=this.json;var n=this.extensions;var a=this.json.scenes[r];var s=this;var i=new THREE.Group;if(a.name)i.name=s.createUniqueName(a.name);O(i,a);if(a.extensions)P(n,i,a);var o=a.nodes||[];var u=[];for(var l=0,f=o.length;l<f;l++){u.push(c(o[l],i,t,s))}return Promise.all(u).then(function(){return i})}}();return e}();