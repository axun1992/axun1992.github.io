THREE.RGBELoader=function(e){THREE.DataTextureLoader.call(this,e);this.type=THREE.UnsignedByteType};THREE.RGBELoader.prototype=Object.assign(Object.create(THREE.DataTextureLoader.prototype),{constructor:THREE.RGBELoader,parse:function(e){var a=-1,g=1,t=2,y=3,m=4,H=function(e,r){switch(e){case g:console.error("THREE.RGBELoader Read Error: "+(r||""));break;case t:console.error("THREE.RGBELoader Write Error: "+(r||""));break;case y:console.error("THREE.RGBELoader Bad File Format: "+(r||""));break;default:case m:console.error("THREE.RGBELoader: Error: "+(r||""))}return a},l=1,f=2,p=4,c="\n",d=function(e,r,a){r=!r?1024:r;var t=e.pos,i=-1,n=0,o="",s=128,E=String.fromCharCode.apply(null,new Uint16Array(e.subarray(t,t+s)));while(0>(i=E.indexOf(c))&&n<r&&t<e.byteLength){o+=E;n+=E.length;t+=s;E+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(t,t+s)))}if(-1<i){if(false!==a)e.pos+=n+i+1;return o+E.slice(0,i)}return false},r=function(e){var r,a,t=/^#\?(\S+)/,i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,E={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(r=d(e))){return H(g,"no header found")}if(!(a=r.match(t))){return H(y,"bad initial token")}E.valid|=l;E.programtype=a[1];E.string+=r+"\n";while(true){r=d(e);if(false===r)break;E.string+=r+"\n";if("#"===r.charAt(0)){E.comments+=r+"\n";continue}if(a=r.match(i)){E.gamma=parseFloat(a[1],10)}if(a=r.match(n)){E.exposure=parseFloat(a[1],10)}if(a=r.match(o)){E.valid|=f;E.format=a[1]}if(a=r.match(s)){E.valid|=p;E.height=parseInt(a[1],10);E.width=parseInt(a[2],10)}if(E.valid&f&&E.valid&p)break}if(!(E.valid&f)){return H(y,"missing format specifier")}if(!(E.valid&p)){return H(y,"missing image size specifier")}return E},i=function(e,r,a){var t,i,n,o,s,E,l,f,p,c,d,u,R=r,T=a,h;if(R<8||R>32767||(2!==e[0]||2!==e[1]||e[2]&128)){return new Uint8Array(e)}if(R!==(e[2]<<8|e[3])){return H(y,"wrong scanline width")}t=new Uint8Array(4*r*a);if(!t.length){return H(m,"unable to allocate buffer space")}i=0;n=0;f=4*R;h=new Uint8Array(4);E=new Uint8Array(f);while(T>0&&n<e.byteLength){if(n+4>e.byteLength){return H(g)}h[0]=e[n++];h[1]=e[n++];h[2]=e[n++];h[3]=e[n++];if(2!=h[0]||2!=h[1]||(h[2]<<8|h[3])!=R){return H(y,"bad rgbe scanline format")}l=0;while(l<f&&n<e.byteLength){o=e[n++];u=o>128;if(u)o-=128;if(0===o||l+o>f){return H(y,"bad scanline data")}if(u){s=e[n++];for(p=0;p<o;p++){E[l++]=s}}else{E.set(e.subarray(n,n+o),l);l+=o;n+=o}}c=R;for(p=0;p<c;p++){d=0;t[i]=E[p+d];d+=R;t[i+1]=E[p+d];d+=R;t[i+2]=E[p+d];d+=R;t[i+3]=E[p+d];i+=4}T--}return t};var n=function(e,r,a,t){var i=e[r+3];var n=Math.pow(2,i-128)/255;a[t+0]=e[r+0]*n;a[t+1]=e[r+1]*n;a[t+2]=e[r+2]*n};var o=function(e,r,a,t){var i=e[r+3];var n=Math.pow(2,i-128)/255;a[t+0]=THREE.DataUtils.toHalfFloat(e[r+0]*n);a[t+1]=THREE.DataUtils.toHalfFloat(e[r+1]*n);a[t+2]=THREE.DataUtils.toHalfFloat(e[r+2]*n)};var s=new Uint8Array(e);s.pos=0;var E=r(s);if(a!==E){var u=E.width,R=E.height,T=i(s.subarray(s.pos),u,R);if(a!==T){switch(this.type){case THREE.UnsignedByteType:var h=T;var v=THREE.RGBEFormat;var F=THREE.UnsignedByteType;break;case THREE.FloatType:var b=T.length/4*3;var w=new Float32Array(b);for(var L=0;L<b;L++){n(T,L*4,w,L*3)}var h=w;var v=THREE.RGBFormat;var F=THREE.FloatType;break;case THREE.HalfFloatType:var b=T.length/4*3;var B=new Uint16Array(b);for(var L=0;L<b;L++){o(T,L*4,B,L*3)}var h=B;var v=THREE.RGBFormat;var F=THREE.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:u,height:R,data:h,header:E.string,gamma:E.gamma,exposure:E.exposure,format:v,type:F}}}return null},setDataType:function(e){this.type=e;return this},load:function(e,a,r,t){function i(e,r){switch(e.type){case THREE.UnsignedByteType:e.encoding=THREE.RGBEEncoding;e.minFilter=THREE.NearestFilter;e.magFilter=THREE.NearestFilter;e.generateMipmaps=false;e.flipY=true;break;case THREE.FloatType:e.encoding=THREE.LinearEncoding;e.minFilter=THREE.LinearFilter;e.magFilter=THREE.LinearFilter;e.generateMipmaps=false;e.flipY=true;break;case THREE.HalfFloatType:e.encoding=THREE.LinearEncoding;e.minFilter=THREE.LinearFilter;e.magFilter=THREE.LinearFilter;e.generateMipmaps=false;e.flipY=true;break}if(a)a(e,r)}return THREE.DataTextureLoader.prototype.load.call(this,e,i,r,t)}});